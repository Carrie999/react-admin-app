(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1017:function(t,e,a){"use strict";a.r(e);var n=a(64),i=a(65),s=a(40),o=a(66),r=a(67),c=a(0),l=a.n(c),h=a(686),u=a.n(h),d=a(737),g=a(666),y=a(198),b=(a(837),a(575)),v=a(574),p=a(662),m=a(628),f=a(130),x=a(13),O=a(1004),j=a(1002),k=a(236),w=new(function(){function t(){Object(n.a)(this,t),this.events={}}return Object(i.a)(t,[{key:"on",value:function(t,e){return this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e),this}},{key:"emit",value:function(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];for(var i=0;i<this.events[t].length;i++)this.events[t][i].apply(this,a);return this}}]),t}()),P=(a(876),[]),_=0,R=1;function B(t){return"Rect"==t?function(){var t=[];return t.mousedown=function(t){if(!t.isPaint){t.isPaint=!0;var e=Y(t);t.curObj.paths=[e]}},t.mouseup=function(t){if(t.isPaint){var e=Y(t);if($(t.curObj.paths[0],e)>10){t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"RBox"==t?function(){var t=[];return t.mousedown=function(t){Y(t),t.isPaint||(t.isPaint=!0)},t.mouseup=function(t){if(t.isPaint){var e=Y(t);if(t.curObj.paths.length<2)t.curObj.paths.push(e);else if(2==t.curObj.paths.length){t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a);var n=t.curObj.paths[0],i=t.curObj.paths[1];t.direction=ct(et(n,i)),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"FBox"==t?function(){var t=[];return t.mousedown=function(t){if(!t.isPaint){t.isPaint=!0;var e=Y(t);t.curObj.paths=[e],t.curObj.direction=t.direction}},t.mouseup=function(t){if(t.isPaint){var e=Y(t);if($(t.curObj.paths[0],e)>3){t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[],t.curObj.direction=null}}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"RingBox"==t?function(){var t=[];return t.mousedown=function(t){if(!t.isPaint){t.isPaint=!0;var e=Y(t);t.curObj.paths=[e],t.curObj.ringObj=t.ringObj}},t.mouseup=function(t){if(t.isPaint){var e=Y(t);if($(t.curObj.paths[0],e)>3){t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[],t.curObj.ringObj=null}}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"Quad"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0)},t.mouseup=function(t){if(t.isPaint)if(t.curObj.paths.length<3){var e=Y(t);t.curObj.paths.push(e)}else{e=Y(t),t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),A(t),q(t.context,a),t.layer.batchDraw()}},t.dblclick=function(t){t.isPaint=!1,t.curObj.paths=[]},t}():"Ring"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0)},t.mouseup=function(t){if(t.isPaint)if(t.curObj.paths.length<2){var e=Y(t);t.curObj.paths.push(e)}else{e=Y(t),t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),A(t),q(t.context,a),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"Circle"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0)},t.mouseup=function(t){if(t.isPaint)if(t.curObj.paths.length<1){var e=Y(t);t.curObj.paths.push(e)}else{e=Y(t),t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),A(t),q(t.context,a),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"FCircle"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0)},t.mouseup=function(t){if(t.isPaint){var e=Y(t);t.curObj.paths.push(e),S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var a=F(t.curObj,t);t.konvaObjs.push(a),t.layer.add(a),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),A(t),q(t.context,a),t.layer.batchDraw()}},t.dblclick=function(t){},t}():"Poly"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0),t.prevPrevClickTime=t.prevClickTime,t.prevClickTime=Date.now()},t.mouseup=function(t){if(t.isPaint){var e=Y(t);t.curObj.paths.length>0?$(e,t.curObj.paths[t.curObj.paths.length-1])>=1&&t.curObj.paths.push(e):t.curObj.paths.push(e)}},t.cancel=function(t){if(t.isPaint)if(t.curObj.paths.length>=2){t.curObj.paths.splice(t.curObj.paths.length-1,1);var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}else 1==t.curObj.paths.length&&(t.isPaint=!1,t.curObj.paths=[],W(t.context),A(t),t.layer.batchDraw())},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.dblclick=function(t){if(!(t.prevClickTime-t.prevPrevClickTime>250)){var e=Y(t),a=t.curObj.paths[t.curObj.paths.length-1];if($(e,a)>2?t.curObj.paths.push(e):t.curObj.paths.length>=2&&$(a,t.curObj.paths[t.curObj.paths.length-2])<2&&t.curObj.paths.pop(),t.curObj.paths.length>2){S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var n=F(t.curObj,t);t.konvaObjs.push(n),t.layer.add(n),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}}},t}():"Curve"==t?function(){var t=[];return t.mousedown=function(t){t.isPaint||(t.curObj.paths=[],t.isPaint=!0);var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()},t.mouseup=function(t){if(t.isPaint){var e=Y(t);t.curObj.paths.push(e)}},t.cancel=function(t){if(t.isPaint&&t.curObj.paths.length>=2){t.curObj.paths.splice(t.curObj.paths.length-1,1);var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw()}},t.mousemove=function(t){if(t.isPaint){var e=Y(t),a=N(t.curObj,e);W(t.context),q(t.context,a),A(t),t.layer.batchDraw(),t.mousePressed&&(e=Y(t),t.curObj.paths.push(e))}},t.dblclick=function(t){var e=Y(t),a=t.curObj.paths[t.curObj.paths.length-1];if($(e,a)>2?t.curObj.paths.push(e):t.curObj.paths.length>=2&&$(a,t.curObj.paths[t.curObj.paths.length-2])<2&&t.curObj.paths.pop(),t.curObj.paths.length>2){S(t.curObj.paths,t.canvasWrapper.x(),t.canvasWrapper.y());var n=F(t.curObj,t);t.konvaObjs.push(n),t.layer.add(n),W(t.context),A(t),t.layer.batchDraw(),t.isPaint=!1,t.curObj.paths=[]}},t}():void 0}function S(t,e,a){for(var n in t)t[n].x+=e,t[n].y+=a}function K(t,e){null!=t.curKonvaObj&&t.curKonvaObj.stroke("red"),e.stroke("blue"),t.layer.batchDraw(),t.curKonvaObj=e}function I(t){null!=t.curKonvaObj&&t.curKonvaObj.stroke("red"),t.layer.batchDraw(),t.curKonvaObj=null}function M(t,e){var a=e.imageBound.x1,n=e.imageBound.x2;return t>=a&&t<=n}function T(t,e){var a=e.imageBound.y1,n=e.imageBound.y2;return t>=a&&t<=n}function E(t,e){var a=e.imageBound.x1,n=e.imageBound.x2;return t<a?a:t>n?n:t}function L(t,e){var a=e.imageBound.y1,n=e.imageBound.y2;return t<a?a:t>n?n:t}function z(t,e,a){for(var n=0;n<t.length/2;n++){var i=t[2*n]+a.x,s=t[2*n+1]+a.y;if(!M(i,e))return!1;if(!T(s,e))return!1}return!0}function F(t,e){var a,n=function(t){var a=this.getAbsolutePosition();if(e.lockKonvaObj&&e.curKonvaObj!=this)return a;var n={x:t.x-a.x,y:t.y-a.y},i=function(t,e,a){var n=e.x,i=e.y,s=t.x,o=t.x+t.width,r=t.y,c=t.y+t.height;return s+n>a.imageBound.x2?n=a.imageBound.x2-s:s+n<a.imageBound.x1&&(n=a.imageBound.x1-s),o+n>a.imageBound.x2?n=a.imageBound.x2-o:o+n<a.imageBound.x1&&(n=a.imageBound.x1-o),r+i>a.imageBound.y2?i=a.imageBound.y2-r:r+i<a.imageBound.y1&&(i=a.imageBound.y1-r),c+i>a.imageBound.y2?i=a.imageBound.y2-c:c+i<a.imageBound.y1&&(i=a.imageBound.y1-c),{x:n,y:i}}(this.getClientRect(),n,e);return{x:a.x+i.x,y:a.y+i.y}};if("Rect"==t.type){var i=function(t){var e=t.paths[0],a=t.paths[1],n=Math.min(e.x,a.x),i=Math.max(e.x,a.x),s={x:n,y:Math.min(e.y,a.y)},o={x:i,y:Math.max(e.y,a.y)};return{type:t.type,paths:[s,o]}}(t);a=new Konva.Rect({x:i.paths[0].x,y:i.paths[0].y,width:i.paths[1].x-i.paths[0].x,height:i.paths[1].y-i.paths[0].y,name:"Rect",stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,draggable:!0,dragBoundFunc:n})}else if("RBox"==t.type){var s=function(t){var e=t.paths[0],a=t.paths[1],n=t.paths[2],i={x:0,y:0},s={x:0,y:0};return tt(e,a,n,i,s),{type:"Quad",paths:[e,a,i,s]}}(t);a=new Konva.Line({name:"RBox",points:J(s.paths),stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n})}else if("FBox"==t.type){s=lt(t);a=new Konva.Line({name:"FBox",points:J(s.paths),stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n})}else if("Curve"==t.type)a=new Konva.Line({name:"Curve",points:J(t.paths),stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n});else if("Poly"==t.type)a=new Konva.Line({name:"Poly",points:J(t.paths),stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n});else if("RingBox"==t.type){var o,r;y=t.paths[0].x,b=t.paths[0].y,f=t.paths[1].x,x=t.paths[1].y;var c=t.ringObj.x,l=t.ringObj.y,h=Math.sqrt((y-c)*(y-c)+(b-l)*(b-l)),u=Math.sqrt((f-c)*(f-c)+(x-l)*(x-l)),d=t.ringObj.r1;v=c+(y-c)*(O=t.ringObj.r2)/h,p=l+(b-l)*O/h,y=c+(y-c)*d/h,b=l+(b-l)*d/h,o=c+(f-c)*d/u,r=l+(x-l)*d/u,f=c+(f-c)*O/u,x=l+(x-l)*O/u,a=new Konva.Line({name:"RingBox",points:[y,b,v,p,f,x,o,r],stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n})}else if("Quad"==t.type)a=new Konva.Line({name:"Quad",points:J(t.paths),stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,closed:!0,draggable:!0,dragBoundFunc:n});else if("FCircle"==t.type){c=t.paths[0].x,l=t.paths[0].y;var g=t.circleObj.radius;a=new Konva.Circle({name:"FCircle",x:c,y:l,radius:g,stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,draggable:!0,dragBoundFunc:n})}else if("Circle"==t.type){var y=t.paths[0].x,b=t.paths[0].y,v=t.paths[1].x,p=t.paths[1].y;0==_?(c=y,l=b,g=Math.sqrt((v-y)*(v-y)+(p-b)*(p-b))):1==_&&(c=(y+v)/2,l=(b+p)/2,g=Math.sqrt((v-y)*(v-y)+(p-b)*(p-b))/2),a=new Konva.Circle({name:"Circle",x:c,y:l,radius:g,stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,draggable:!0,dragBoundFunc:n})}else if("Ring"==t.type){y=t.paths[0].x,b=t.paths[0].y,v=t.paths[1].x,p=t.paths[1].y;var m,f=t.paths[2].x,x=t.paths[2].y;if(0==_)c=y,l=b,m=Math.sqrt((v-y)*(v-y)+(p-b)*(p-b)),u=Math.sqrt((f-y)*(f-y)+(x-b)*(x-b));else if(1==_){c=(y+v)/2,l=(b+p)/2,m=Math.sqrt((v-y)*(v-y)+(p-b)*(p-b))/2,u=Math.sqrt((f-c)*(f-c)+(x-l)*(x-l));d=Math.min(m,u);var O=Math.max(m,u);m=d,u=O}a=new Konva.Ring({name:"Ring",x:c,y:l,innerRadius:m,outerRadius:u,stroke:"red",strokeWidth:1,strokeScaleEnabled:!1,draggable:!0,dragBoundFunc:n})}return a.opacity(R),function(t,e){t.on("mousedown",function(){if(!e.isPaint&&(!e.lockKonvaObj||e.curKonvaObj!=this)){bt(e,this);var t=e.konvaObjs.indexOf(e.curKonvaObj);w.emit("focusIndex",t)}}),t.on("dblclick",function(){}),t.on("mouseout",function(){e.isPaint||e.lockKonvaObj||I(e)}),t.on("mouseover",function(){e.isPaint||e.lockKonvaObj||K(e,this)}),t.on("dragstart",function(){e.lockKonvaObj&&e.curKonvaObj!=this&&ht(e),K(e,this)}),t.on("dragmove",function(t){W(e.context),A(e)}),t.on("dragend",function(t){}),t.on("keydown",function(t){console.log("key: "+t.keyCode),t.preventDefault(),e.layer.batchDraw()})}(a,e),a}function W(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}function A(t){var e=t.context;for(var a in e.font="16px serif",e.fillStyle="#2699cf",t.konvaObjs){var n,i,s=t.konvaObjs[a];"Rect"==s.name()||"Ring"==s.name()||"Circle"==s.name()||"FCircle"==s.name()?(n=s.x(),i=s.y()):(n=s.attrs.points[0]+s.getAbsolutePosition().x,i=s.attrs.points[1]+s.getAbsolutePosition().y),e.fillText((Number(a)+1).toString(),n,i)}}function N(t,e){var a=function t(e){var a;if("object"==Object(k.a)(e))if(null===e)a=null;else if(e instanceof Array){a=[];for(var n=0,i=e.length;n<i;n++)a.push(t(e[n]))}else for(var s in a={},e)a[s]=t(e[s]);else a=e;return a}(t);return a.paths.push(e),a}function q(t,e){t.strokeStyle="red",t.linewidth=1,"Rect"==e.type?function(t,e){if(2==e.paths.length){var a=e.paths[0],n=e.paths[1];t.strokeRect(a.x,a.y,n.x-a.x,n.y-a.y)}}(t,e):"RBox"==e.type?function(t,e){var a,n,i,s,o,r,c,l,h,u,d,g,y;2==e.paths.length?(a=e.paths[0],n=e.paths[1],r=a.x,c=a.y,l=n.x,h=n.y,t.beginPath(),t.moveTo(r,c),t.lineTo(l,h),t.stroke()):3==e.paths.length&&(a=e.paths[0],n=e.paths[1],r=a.x,c=a.y,l=n.x,h=n.y,a={x:r,y:c},n={x:l,y:h},i=e.paths[2],tt(a,n,i,s={x:0,y:0},o={x:0,y:0}),u=s.x,d=s.y,g=o.x,y=o.y,t.beginPath(),t.moveTo(r,c),t.lineTo(l,h),t.moveTo(l,h),t.lineTo(u,d),t.moveTo(u,d),t.lineTo(g,y),t.moveTo(g,y),t.lineTo(r,c),t.closePath(),t.stroke())}(t,e):"FBox"==e.type?function(t,e){if(2==e.paths.length){var a=lt(e);q(t,a)}}(t,e):"Quad"==e.type?function(t,e){t.beginPath();for(var a=0;a<e.paths.length-1;a++){var n=e.paths[a],i=e.paths[a+1];n&&t.moveTo(n.x,n.y),i&&t.lineTo(i.x,i.y)}if(4==e.paths.length){var n=e.paths[3],i=e.paths[0];n&&t.moveTo(n.x,n.y),i&&t.lineTo(i.x,i.y)}t.closePath(),t.stroke()}(t,e):"Ring"==e.type?function(t,e){if(0==_){t.beginPath();var a=e.paths[0].x,n=e.paths[0].y;if(e.paths.length>=2){var i=e.paths[1].x,s=e.paths[1].y,o=Math.sqrt((i-a)*(i-a)+(s-n)*(s-n));t.arc(a,n,o,0,2*Math.PI)}if(t.closePath(),t.stroke(),t.beginPath(),e.paths.length>=3){var r=e.paths[2].x,c=e.paths[2].y,o=Math.sqrt((r-a)*(r-a)+(c-n)*(c-n));t.arc(a,n,o,0,2*Math.PI)}t.closePath(),t.stroke()}else if(1==_){t.beginPath();var l,h,a=e.paths[0].x,n=e.paths[0].y;if(e.paths.length>=2&&(i=e.paths[1].x,s=e.paths[1].y,l=(a+i)/2,h=(n+s)/2,o=Math.sqrt((i-a)*(i-a)+(s-n)*(s-n))/2,t.arc(l,h,o,0,2*Math.PI)),t.closePath(),t.stroke(),t.beginPath(),e.paths.length>=3){r=e.paths[2].x,c=e.paths[2].y;var o=Math.sqrt((r-l)*(r-l)+(c-h)*(c-h));t.arc(l,h,o,0,2*Math.PI)}t.closePath(),t.stroke()}}(t,e):"Circle"==e.type?function(t,e){if(0==_){var a=e.paths[0].x,n=e.paths[0].y;if(t.beginPath(),t.arc(a,n,4,0,2*Math.PI),t.fillStyle="green",t.closePath(),t.fill(),e.paths.length>=2){var i=e.paths[1].x,s=e.paths[1].y,o=Math.sqrt((i-a)*(i-a)+(s-n)*(s-n));t.beginPath(),t.arc(a,n,o,0,2*Math.PI),t.closePath(),t.stroke()}}else if(1==_){var r,c,a=e.paths[0].x,n=e.paths[0].y;e.paths.length>=2&&(i=e.paths[1].x,s=e.paths[1].y,r=(a+i)/2,c=(n+s)/2,t.beginPath(),t.arc(r,c,4,0,2*Math.PI),t.fillStyle="green",t.closePath(),t.fill(),o=Math.sqrt((i-a)*(i-a)+(s-n)*(s-n))/2,t.beginPath(),t.arc(r,c,o,0,2*Math.PI),t.closePath(),t.stroke())}}(t,e):"FCircle"==e.type?function(t,e){var a=e.paths[0].x,n=e.paths[0].y,i=e.circleObj.radius;t.beginPath(),t.arc(a,n,4,0,2*Math.PI),t.fillStyle="green",t.closePath(),t.fill(),t.beginPath(),t.arc(a,n,i,0,2*Math.PI),t.closePath(),t.stroke()}(t,e):"RingBox"==e.type?function(t,e){if(2==e.paths.length){var a,n,i,s,o=e.paths[0].x,r=e.paths[0].y,c=e.paths[1].x,l=e.paths[1].y,h=e.ringObj.x,u=e.ringObj.y,d=Math.sqrt((o-h)*(o-h)+(r-u)*(r-u)),g=Math.sqrt((c-h)*(c-h)+(l-u)*(l-u)),y=e.ringObj.r1,b=e.ringObj.r2;i=h+(o-h)*b/d,s=u+(r-u)*b/d,o=h+(o-h)*y/d,r=u+(r-u)*y/d,n=h+(c-h)*y/g,a=u+(l-u)*y/g,c=h+(c-h)*b/g,l=u+(l-u)*b/g,t.beginPath(),t.moveTo(o,r),t.lineTo(i,s),t.moveTo(i,s),t.lineTo(c,l),t.moveTo(c,l),t.lineTo(n,a),t.moveTo(n,a),t.lineTo(o,r),t.closePath(),t.stroke()}}(t,e):"Poly"==e.type?V(t,e):"Curve"==e.type&&V(t,e)}function Q(t){function e(t,e,a,n){return 0==a.x?null:{x:n,y:a.y/a.x*(n-t)+e}}function a(t,e,a,n){return 0==a.y?null:{x:a.x/a.y*(n-e)+t,y:n}}function n(t,e){return null!=e&&(e.x>=0&&e.x<=t.canvas.width&&e.y>=0&&e.y<=t.canvas.height)}function i(t,i,s,o){var r=[],c=[];for(var l in c.push(e(i,s,o,0)),c.push(e(i,s,o,t.canvas.width)),c.push(a(i,s,o,0)),c.push(a(i,s,o,t.canvas.height)),c){var h=c[l];n(t,h)&&r.push(h)}2==r.length&&(t.beginPath(),t.moveTo(r[0].x,r[0].y),t.lineTo(r[1].x,r[1].y),t.stroke())}if("RingBox"==t.curObj.type){var s=t.context,o=Y(t);s.strokeStyle="#45f1f9",s.beginPath(),s.moveTo(t.ringObj.x,t.ringObj.y),s.lineTo(o.x,o.y),s.stroke()}if("FCircle"==t.curObj.type){s=t.context;var r=(o=Y(t)).x,c=o.y,l=t.curObj.circleObj.radius;s.beginPath(),s.arc(r,c,4,0,2*Math.PI),s.fillStyle="green",s.closePath(),s.fill(),s.strokeStyle="#45f1f9",s.beginPath(),s.arc(r,c,l,0,2*Math.PI),s.closePath(),s.stroke()}else if("FBox"==t.curObj.type&&null!=t.direction){(s=t.context).strokeStyle="#45f1f9",i(s,(o=Y(t)).x,o.y,t.direction),i(s,o.x,o.y,{x:(h=t.direction).y,y:-h.x})}else if("Poly"!=t.curObj.type&&"Curve"!=t.curObj.type){s=t.context,o=Y(t);s.strokeStyle="#45f1f9",s.linewidth=.5,function(t,e){t.beginPath(),t.moveTo(e+.5,0),t.lineTo(e+.5,t.canvas.height),t.stroke()}(s,o.x),function(t,e){t.beginPath(),t.moveTo(0,e+.5),t.lineTo(t.canvas.width,e+.5),t.stroke()}(s,o.y)}var h}function V(t,e){t.beginPath();for(var a=0;a<e.paths.length-1;a++){var n=e.paths[a],i=e.paths[a+1];t.moveTo(n.x,n.y),t.lineTo(i.x,i.y)}t.closePath(),t.stroke()}function Y(t){var e=t.stage.getPointerPosition();return e||(e=t.lastPos?t.lastPos:{x:t.stage.width()/2,y:t.stage.height()/2}),e={x:e.x-t.canvasWrapper.x(),y:e.y-t.canvasWrapper.y()},t.imageBound&&(e.x=Math.max(Math.min(e.x,t.imageBound.x2),t.imageBound.x1),e.y=Math.max(Math.min(e.y,t.imageBound.y2),t.imageBound.y1)),t.lastPos=e,e}function X(t){for(var e=[],a=0;a<t.length/2;a++)e.push({x:t[2*a],y:t[2*a+1]});return e}function J(t){for(var e=[],a=0;a<t.length;a++)t[a]&&(e.push(t[a].x),e.push(t[a].y));return e}function U(t){var e=t.bkgImg.width,a=t.bkgImg.height,n=t.stage.width(),i=t.stage.height(),s=t.canvas_margin,o=n-2*s,r=i-2*s;return a/e>r/o?r/a:o/e}function G(t){var e=U(t),a=t.zoom_factor,n=Z(t);return{x:(n.x-t.image_center.x)/(e*a)+t.bkgImg.width/2,y:(n.y-t.image_center.y)/(e*a)+t.bkgImg.height/2,width:n.width/(e*a),height:n.height/(e*a)}}function Z(t){U(t),t.zoom_factor;var e=H(t),a=Math.max(e.x1,t.canvas_margin),n=Math.max(e.y1,t.canvas_margin);return{x:a,y:n,width:Math.min(e.x2,t.stage.width()-t.canvas_margin)-a,height:Math.min(e.y2,t.stage.height()-t.canvas_margin)-n}}function H(t){var e=U(t),a=t.zoom_factor;return{x1:-t.bkgImg.width/2*e*a+t.image_center.x,x2:t.bkgImg.width/2*e*a+t.image_center.x,y1:-t.bkgImg.height/2*e*a+t.image_center.y,y2:t.bkgImg.height/2*e*a+t.image_center.y,width:t.bkgImg.width*e*a,height:t.bkgImg.height*e*a}}function $(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}function tt(t,e,a,n,i){var s=et(t,a),o=et(t,e),r=it(o),c=ot(function(t){if(t)return{x:-t.x,y:-t.y}}(st(o,at(s,o)/r)),s);t&&e&&n&&i&&c&&(n.x=e.x+c.x,n.y=e.y+c.y,i.x=t.x+c.x,i.y=t.y+c.y)}function et(t,e){return{x:e.x-t.x,y:e.y-t.y}}function at(t,e){if(t&&e)return t.x*e.x+t.y*e.y}function nt(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function it(t){if(t)return t.x*t.x+t.y*t.y}function st(t,e){if(t)return{x:t.x*e,y:t.y*e}}function ot(t,e){return t&&e?{x:t.x+e.x,y:t.y+e.y}:null}function rt(t,e){if(t&&e)return t.x*e.y-t.y*e.x}function ct(t){return st(t,1/nt(t))}function lt(t){var e=t.direction,a=t.paths[0],n=t.paths[1],i=et(a,n),s=(at(i,e),nt(i),ot(a,st(e,at(i,e)))),o=function(t,e){if(t&&e)return{x:t.x-e.x,y:t.y-e.y}}(ot(a,n),s);return{type:"Quad",paths:[t.paths[0],s,t.paths[1],o]}}function ht(t){t.lockKonvaObj=!1,null!=t.curKonvaObj&&(t.curKonvaObj.stroke("red"),t.curKonvaObj=null),t.stage.find(".Transformer").destroy(),t.layer.batchDraw()}function ut(t,e,a,n){return function(t,e,a){var n=et(t,e),i=n.x*a[0]+n.y*a[2],s=n.x*a[1]+n.y*a[3];return{x:t.x+i,y:t.y+s}}(t,n,function(t,e,a){var n=et(t,e),i=et(t,a),s=nt(n)*nt(i),o=at(n,i)/s,r=rt(n,i)/s;return[o,r,-r,o]}(t,e,a))}function dt(t,e){var a=t.getAbsolutePosition(),n=new Konva.Group({name:"Transformer",x:a.x,y:a.y,draggable:!0});n._node=t;var i=e.anchor_size,s=i/2,o=new Konva.Rect({x:t.attrs.points[0]-s,y:t.attrs.points[1]-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0}),r=new Konva.Rect({x:t.attrs.points[2]-s,y:t.attrs.points[3]-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0}),c=new Konva.Rect({x:(t.attrs.points[4]+t.attrs.points[6])/2-s,y:(t.attrs.points[5]+t.attrs.points[7])/2-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0});return n.add(o),n.add(r),n.add(c),o.on("dragmove",function(a){n.children.indexOf(a.target);var i=a.target.getParent()._node,r=i.getAbsolutePosition(),l=a.target.getX(),h=a.target.getY(),u=E(l+r.x+s,e),d=L(h+ +r.y+s,e),g={};g.x=u-r.x,g.y=d-r.y;var y=function(t,e){var a={x:t[0],y:t[1]},n={x:t[2],y:t[3]},i={x:t[4],y:t[5]},s=(t[6],t[7],ut(n,a,e,i)),o=n,r={x:e.x+s.x-o.x,y:e.y+s.y-o.y};return[e.x,e.y,o.x,o.y,s.x,s.y,r.x,r.y]}(i.attrs.points,g);if(z(y,e,r))for(var b=0;b<8;b++)i.attrs.points[b]=y[b];var v={x:i.attrs.points[0],y:i.attrs.points[1]},p={x:i.attrs.points[2],y:i.attrs.points[3]};e.direction=ct(et(v,p)),o.x(i.attrs.points[0]-s),o.y(i.attrs.points[1]-s),c.x((i.attrs.points[4]+i.attrs.points[6])/2-s),c.y((i.attrs.points[5]+i.attrs.points[7])/2-s),t.getLayer().draw()}),r.on("dragmove",function(a){n.children.indexOf(a.target);var i=a.target.getParent()._node,o=i.getAbsolutePosition(),l=a.target.getX(),h=a.target.getY(),u=E(l+o.x+s,e),d=L(h+ +o.y+s,e),g={};g.x=u-o.x,g.y=d-o.y;var y=function(t,e){var a={x:t[0],y:t[1]},n={x:t[2],y:t[3]},i=(t[4],t[5],ut(a,n,e,{x:t[6],y:t[7]})),s=a,o={x:e.x+i.x-s.x,y:e.y+i.y-s.y};return[s.x,s.y,e.x,e.y,o.x,o.y,i.x,i.y]}(i.attrs.points,g);if(z(y,e,o))for(var b=0;b<8;b++)i.attrs.points[b]=y[b];var v={x:i.attrs.points[0],y:i.attrs.points[1]},p={x:i.attrs.points[2],y:i.attrs.points[3]};e.direction=ct(et(v,p)),r.x(i.attrs.points[2]-s),r.y(i.attrs.points[3]-s),c.x((i.attrs.points[4]+i.attrs.points[6])/2-s),c.y((i.attrs.points[5]+i.attrs.points[7])/2-s),t.getLayer().draw()}),c.on("dragmove",function(a){n.children.indexOf(a.target);var i=a.target.getParent()._node,o=i.getAbsolutePosition(),r=a.target.getX(),l=a.target.getY(),h=E(r+o.x+s,e),u=L(l+ +o.y+s,e),d={};d.x=h-o.x,d.y=u-o.y;var g=function(t,e){var a={x:t[0],y:t[1]},n={x:t[2],y:t[3]};return C={x:0,y:0},D={x:0,y:0},tt(a,n,e,C,D),[a.x,a.y,n.x,n.y,C.x,C.y,D.x,D.y]}(i.attrs.points,d);if(z(g,e,o))for(var y=0;y<8;y++)i.attrs.points[y]=g[y];c.x((i.attrs.points[4]+i.attrs.points[6])/2-s),c.y((i.attrs.points[5]+i.attrs.points[7])/2-s),t.getLayer().draw()}),t.on("dragmove",function(t){var e=t.target.getAbsolutePosition();n.x(e.x),n.y(e.y),t.target.getLayer().draw()}),n}function gt(t,e){var a=t.getAbsolutePosition(),n=new Konva.Group({name:"Transformer",x:a.x,y:a.y,draggable:!0});n._node=t;var i=e.anchor_size,s=i/2,o=new Konva.Rect({x:t.attrs.points[0]-s,y:t.attrs.points[1]-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0}),r=new Konva.Rect({x:t.attrs.points[4]-s,y:t.attrs.points[5]-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0});return n.add(o),n.add(r),o.on("dragmove",function(a){n.children.indexOf(a.target);var i=a.target.getParent()._node,o=i.getAbsolutePosition(),r=a.target.getX(),c=a.target.getY(),l=E(r+o.x+s,e),h=L(c+ +o.y+s,e),u={};u.x=l-o.x,u.y=h-o.y;var d=function(t,e){t[0],t[1];var a={x:t[2],y:t[3]},n={x:t[4],y:t[5]},i={x:t[6],y:t[7]},s=et(n,e),o=et(n,a),r=ot(n,st(o,at(o,s)/it(o))),c=et(n,i),l=ot(n,st(c,at(c,s)/it(c)));return[e.x,e.y,r.x,r.y,n.x,n.y,l.x,l.y]}(i.attrs.points,u);if(z(d,e,o)){for(var g=0;g<8;g++)i.attrs.points[g]=d[g];a.target.x(l-o.x-s),a.target.y(h-o.y-s),t.getLayer().draw()}else a.target.x(i.attrs.points[0]-s),a.target.y(i.attrs.points[1]-s),t.getLayer().draw()}),r.on("dragmove",function(a){n.children.indexOf(a.target);var i=a.target.getParent()._node,o=i.getAbsolutePosition(),r=a.target.getX(),c=a.target.getY(),l=E(r+o.x+s,e),h=L(c+ +o.y+s,e),u={};u.x=l-o.x,u.y=h-o.y;var d=function(t,e){var a={x:t[0],y:t[1]},n={x:t[2],y:t[3]},i=(t[4],t[5],{x:t[6],y:t[7]}),s=et(a,e),o=et(a,n),r=ot(a,st(o,at(o,s)/it(o))),c=et(a,i),l=ot(a,st(c,at(c,s)/it(c)));return[a.x,a.y,r.x,r.y,e.x,e.y,l.x,l.y]}(i.attrs.points,u);if(z(d,e,o)){for(var g=0;g<8;g++)i.attrs.points[g]=d[g];a.target.x(l-o.x-s),a.target.y(h-o.y-s),t.getLayer().draw()}else a.target.x(i.attrs.points[4]-s),a.target.y(i.attrs.points[5]-s),t.getLayer().draw()}),t.on("dragmove",function(t){var e=t.target.getAbsolutePosition();n.x(e.x),n.y(e.y),t.target.getLayer().draw()}),n}function yt(t,e){var a;return"Rect"==t.name()?((a=new Konva.Transformer({name:"Transformer",keepRatio:!1,anchorSize:e.anchor_size,rotateEnabled:"RBox"==t.name()||"FBox"==t.name(),borderEnabled:!1,boundBoxFunc:function(t,a){return function(t,e){var a=t.x,n=t.x+t.width,i=t.y,s=t.y+t.height,o=e.imageBound.x1,r=e.imageBound.x2,c=e.imageBound.y1,l=e.imageBound.y2;return a>=o&&a<=r&&n>=o&&n<=r&&i>=c&&i<=l&&s>=c&&s<=l}(a,e)?a:function(t,e){var a=t.x,n=t.x+t.width,i=t.y,s=t.y+t.height;return a=E(a,e),n=E(n,e),{x:a,y:i=L(i,e),width:n-a,height:(s=L(s,e))-i}}(a,e)}})).attachTo(t),a):"Ring"==t.name()||"Circle"==t.name()||"FCircle"==t.name()?((a=new Konva.Transformer({name:"Transformer",keepRatio:!0,anchorSize:e.anchor_size,rotateEnabled:!0,borderEnabled:!1})).attachTo(t),a):"RBox"==t.name()?dt(t,e):"FBox"==t.name()?gt(t,e):"Poly"==t.name()||"Curve"==t.name()||"Quad"==t.name()||"RingBox"==t.name()?function(t,e){var a=t.getAbsolutePosition(),n=new Konva.Group({name:"Transformer",x:a.x,y:a.y,draggable:!0});n._node=t;for(var i=e.anchor_size,s=i/2,o=0;o<t.attrs.points.length/2;o++){a=t.getAbsolutePosition();var r=new Konva.Rect({x:t.attrs.points[2*o]-s,y:t.attrs.points[2*o+1]-s,width:i,height:i,stroke:"rgb(0, 161, 255)",draggable:!0});n.add(r),r.on("dragmove",function(a){var i=n.children.indexOf(a.target),o=a.target.getParent()._node,r=o.getAbsolutePosition(),c=a.target.getX(),l=a.target.getY(),h=E(c+r.x+s,e),u=L(l+ +r.y+s,e);o.attrs.points[2*i]=h-r.x,o.attrs.points[2*i+1]=u-r.y,a.target.x(h-r.x-s),a.target.y(u-r.y-s),t.getLayer().draw()}),r.on("mouseover",function(t){t.target.stroke("red");var e=t.target.getParent();null!=e&&(e.getLayer().draw(),e._activateIndex=e.children.indexOf(t.target))}),r.on("mouseout",function(t){t.target.stroke("rgb(0, 161, 255)");var e=t.target.getParent();null!=e&&(e.getLayer().draw(),e._activateIndex=-1)})}return t.on("dragmove",function(t){var e=t.target.getAbsolutePosition();n.x(e.x),n.y(e.y),t.target.getLayer().draw()}),n}(t,e):void 0}function bt(t,e){null!=t.curKonvaObj&&t.curKonvaObj.stroke("red"),t.curKonvaObj=e,t.curKonvaObj.stroke("blue"),t.lockKonvaObj=!0,t.stage.find(".Transformer").destroy();var a=yt(e,t);t.layer.add(a),t.layer.batchDraw()}function vt(t){var e,a=(new Date).getTime(),n=(e=a,(e=new Date(1e3*e)).getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds()))+" "+t;P.length<10?P.splice(0,0,n):(P.pop(),P.splice(0,0,n))}function pt(t){var e=["Rect","RBox","FBox","Quad","Poly","Curve","Circle","FCircle","Ring","RingBox"],a=[];for(var n in e){var i=e[n];a[i]=B(i)}t.shape_funcs=a,t.canvasWrapper.on("mousedown touchstart",function(){null!=t.curObj.type&&a[t.curObj.type].mousedown(t),t.mousePressed=!0,t.moveMode&&(t.stage.container().style.cursor="move",t.last_move_pos=Y(t)),t.copyMode&&(t.konvaObjs.push(t.copyObj),t.copyObj=t.copyObj.clone(),t.layer.add(t.copyObj),W(t.context),A(t),t.layer.batchDraw())}),t.stage.on("mouseup touchend",function(){null!=t.curObj.type&&a[t.curObj.type].mouseup(t),t.moveMode&&t.mousePressed&&(t.shift_zoom_center(),t.last_move_pos=Y(t)),t.mousePressed=!1,t.stage.container().style.cursor="default"}),t.stage.on("mousemove touchmove",function(e){var n=Y(t);t.copyMode?(t.copyObj.x(n.x),t.copyObj.y(n.y),W(t.context),A(t),t.layer.batchDraw()):t.isPaint?null!=t.curObj.type&&("Poly"!==t.curObj.type&&(t.stage.container().style.cursor="crosshair"),a[t.curObj.type].mousemove(t),Q(t)):(t.moveMode&&t.mousePressed?(t.stage.container().style.cursor="move",t.shift_zoom_center(),t.last_move_pos=Y(t)):t.stage.container().style.cursor="default",e.target!==t.stage&&e.target!==t.canvasWrapper||t.lockKonvaObj||I(t))}),t.canvasWrapper.on("mousemove touchmove",function(){t.isPaint||(t.moveMode&&t.mousePressed?(t.stage.container().style.cursor="move",t.shift_zoom_center(),t.last_move_pos=Y(t)):t.stage.container().style.cursor="default",W(t.context),Q(t),A(t),t.layer.batchDraw())}),t.stage.on("dblclick",function(e){if(!t.lockKonvaObj||"Poly"!=t.curKonvaObj.name()&&"Curve"!=t.curKonvaObj.name())null!=t.curObj.type&&a[t.curObj.type].dblclick(t);else{var n=t.stage.find(".Transformer")[0]._node,i=t.stage.getPointerPosition(),s=n.getAbsolutePosition();i.x-=s.x,i.y-=s.y;var o=function(t,e){function a(t,e){var a=t.p1,n=t.p2,i=et(a,e),s=et(a,n),o=nt(i),r=nt(s),c=at(i,s)/(o*r);return o*Math.sqrt(1-c*c)}function n(t,e,a){return at(et(e,t),et(e,a))>0}return function(t,e){for(var i=1e5,s=-1,o=0;o<t.length;o++)if(n(e,t[o].p1,t[o].p2)&&n(e,t[o].p2,t[o].p1)&&nt(et(e,t[o].p1))+nt(et(e,t[o].p2))<1.3*nt(et(t[o].p1,t[o].p2))){var r=a(t[o],e);r<i&&(i=r,s=o)}return s}(function(t){for(var e=[],a=t.length/2,n=0;n<a-1;n++){var i={x:t[2*n],y:t[2*n+1]},s={x:t[2*n+2],y:t[2*n+3]};e.push({p1:i,p2:s})}return i={x:t[2*a-2],y:t[2*a-1]},s={x:t[0],y:t[1]},e.push({p1:i,p2:s}),e}(t),e)}(n.attrs.points,i);n.attrs.points.splice(2*o+2,0,i.x),n.attrs.points.splice(2*o+3,0,i.y),ht(t),bt(t,n),n.getLayer().draw()}}),t.stage.on("mousedown",function(e){e.target!==t.stage&&e.target!==t.canvasWrapper||ht(t)})}function mt(t){var e=t.width,a=t.height,n=t.margin,i=new Konva.Stage({container:t.container,width:e,height:a}),s=new Konva.Layer,o=new Konva.Layer;i.add(s),i.add(o);var r=document.createElement("canvas");r.width=i.width(),r.height=i.height();var c=new Image,l=null,h=null,u=this;c.onload=function(){u.bkgImg=c,u.zoom_factor=1,u.image_center={x:e/2,y:a/2};var n=H(u);(h={}).x1=n.x1,h.x2=n.x2,h.y1=n.y1,h.y2=n.y2,h.width=n.width,h.height=n.height,l=new Konva.Image({x:h.x1,y:h.y1,image:c,width:h.width,height:h.height}),u.bkgKImg=l,s.add(l),s.batchDraw(),u.orig_results=t.results,u.imageBound=h,u.layer=o,u.loadResults()},c.src=t.imgpath;var d=new Konva.Image({image:r,x:0,y:0,stroke:"#cad2db"});o.add(d),i.draw();var g=r.getContext("2d");g.strokeStyle="#df4b26",g.lineWidth=1,this.zoom_factor=1,this.image_center={x:e/2,y:a/2},this.moveMode=!1,this.orig_width=e,this.orig_height=a,this.orig_results=t.results,this.imageBound=h,this.bkgImg=c,this.bkgKImg=l,this.bkgLayer=s,this.curObj={paths:[],type:"Rect"},this.isPaint=!1,this.stage=i,this.layer=o,this.canvasWrapper=d,this.context=g,this.direction={x:1,y:0},this.canvas_margin=n,this.anchor_size=5,this.curKonvaObj=null,this.lockKonvaObj=!1,this.konvaObjs=[],this.ringObj=null,this.copyObj=null,this.bindEvents=function(){pt(this)},this.deleteObj=function(t){if(this.lockKonvaObj){if(null!=this.curKonvaObj){var e=this.stage.find(".Transformer")[0];if("Poly"!=this.curKonvaObj.name()&&"Curve"!=this.curKonvaObj.name()||null==e._activateIndex||-1==e._activateIndex)e.destroy(),w.emit("stateContent",this.konvaObjs.indexOf(this.curKonvaObj)),this.konvaObjs.splice(this.konvaObjs.indexOf(this.curKonvaObj),1),this.curKonvaObj.destroy(),this.curKonvaObj=null,this.lockKonvaObj=!1;else{console.log(222),e.children[e._activateIndex].destroy();var a=e._node;a.attrs.points.splice(2*e._activateIndex+1,1),a.attrs.points.splice(2*e._activateIndex,1),e._activateIndex=-1}}}else null!=this.curKonvaObj&&(w.emit("stateContent",this.konvaObjs.indexOf(this.curKonvaObj)),this.konvaObjs.splice(this.konvaObjs.indexOf(this.curKonvaObj),1),this.curKonvaObj.destroy()),(t||0===t)&&(w.emit("stateContent",t),this.curKonvaObj=this.konvaObjs[t],this.konvaObjs.splice(t,1),this.curKonvaObj.destroy()),this.curKonvaObj=null;W(this.context),A(this),this.layer.draw()},this.displayResult=function(){var t=[];for(var e in this.konvaObjs){var a,n=this.konvaObjs[e];if("Rect"==n.name()){var i=n.x(),s=n.y();a={type:"Rect",paths:[{x:i,y:s},{x:i+n.width()*n.scaleX(),y:s+n.height()*n.scaleY()}]}}else if("FCircle"==n.name()||"Circle"==n.name()){var o=n.x(),r=n.y();a={type:"Circle",paths:[{x:o,y:r},{x:o+n.radius(),y:r}]}}else if("RBox"==n.name()||"FBox"==n.name()||"Quad"==n.name()||"Poly"==n.name()||"Curve"==n.name()||"RingBox"==n.name()||"Ring"==n.name()){var c=X(n.attrs.points),l=n.getAbsolutePosition();for(var e in c)c[e].x+=l.x,c[e].y+=l.y;a={type:n.name(),paths:c}}if(null!=this.imageBound){for(var e in a.paths)a.paths[e].x=(a.paths[e].x-this.imageBound.x1)/this.imageBound.width,a.paths[e].y=(a.paths[e].y-this.imageBound.y1)/this.imageBound.height;t.push(a)}}return t},this.loadResults=function(t){var e=JSON.parse(this.orig_results);for(var a in e){var n=e[a];if(null!=this.imageBound){for(var a in n.paths)vt("loadResults: "+n.paths[a].x+" "+n.paths[a].y),n.paths[a].x=n.paths[a].x*this.imageBound.width+this.imageBound.x1,n.paths[a].y=n.paths[a].y*this.imageBound.height+this.imageBound.y1;var i=F(n,this);this.layer.add(i),this.konvaObjs.push(i)}}A(this),this.layer.draw(),this.displayResult()},this.repaint=function(){if(null!=this.curKonvaObj&&("Poly"==this.curKonvaObj.name()||"Curve"==this.curKonvaObj.name())){var t=this.curKonvaObj;ht(this);var e=this.konvaObjs.indexOf(t);this.konvaObjs.splice(e,1);var a=X(t.attrs.points),n=t.getAbsolutePosition();for(var i in a)a[i].x+=n.x,a[i].y+=n.y;this.setMode(t.name()),this.curObj.type=t.name(),this.curObj.paths=a,this.isPaint=!0,t.destroy(),W(this.context),q(this.context,this.curObj),A(this),this.layer.batchDraw()}},this.cancel=function(){this.lockKonvaObj?ht(this):this.isPaint&&("Poly"==this.curObj.type||"Curve"==this.curObj.type?null!=this.shape_funcs&&this.shape_funcs[this.curObj.type].cancel(this):(this.curObj.paths=[],this.isPaint=!1,W(this.context)))},this.zoom_in=function(){this.zoom_factor*=1.1,vt("zoom_factor = "+this.zoom_factor),this.update_zoom(1.1)},this.zoom_out=function(){this.zoom_factor*=1/1.1,vt("zoom_factor = "+this.zoom_factor),this.update_zoom(1/1.1)},this.shift_zoom_center=function(){var t=this.last_move_pos,e=Y(this),a={x:e.x-t.x,y:e.y-t.y};this.update_move(a)},this.update_move=function(t){U(this),u.zoom_factor;for(var e in this.image_center.x+=t.x,this.image_center.y+=t.y,this.imageBound.x1+=t.x,this.imageBound.x2+=t.x,this.imageBound.y1+=t.y,this.imageBound.y2+=t.y,this.imageROI=G(this),this.canvasROI=Z(this),this.bkgKImg.destroy(),this.bkgKImg=new Konva.Image({image:this.bkgImg,crop:this.imageROI,x:this.canvasROI.x,y:this.canvasROI.y,width:this.canvasROI.width,height:this.canvasROI.height}),this.bkgLayer.add(this.bkgKImg),this.bkgLayer.batchDraw(),this.ringObj&&(this.ringObj.x=this.ringObj.x+t.x,this.ringObj.y=this.ringObj.y+t.y),this.konvaObjs){var a=this.konvaObjs[e];if("Rect"==a.name()){var n=a.x(),i=a.y(),s=(h=a.width(),d=a.height(),n+t.x),o=i+t.y,r=h,c=d;a.x(s),a.y(o),a.width(r),a.height(c)}else if("Ring"==a.name()){n=(l=a.getAbsolutePosition()).x,i=l.y,s=n+t.x,o=i+t.y;a.x(s),a.y(o)}else if("RBox"==a.name()||"FBox"==a.name()||"Quad"==a.name()||"Poly"==a.name()||"Curve"==a.name()||"RingBox"==a.name()){X(a.attrs.points),n=(l=a.getAbsolutePosition()).x,i=l.y;var l,h=a.width(),d=a.height();s=n+t.x,o=i+t.y,r=h,c=d;a.x(s),a.y(o),a.width(r),a.height(c)}if(!this.isPaint&&null!=this.curKonvaObj&&this.lockKonvaObj&&("RBox"==this.curKonvaObj.name()||"FBox"==this.curKonvaObj.name()||"Poly"==this.curKonvaObj.name()||"Curve"==this.curKonvaObj.name()||"Quad"==this.curKonvaObj.name()||"Ring"==this.curKonvaObj.name()||"RingBox"==this.curKonvaObj.name())){var g=this.curKonvaObj;ht(this),bt(this,g)}}W(this.context),A(this),this.layer.batchDraw()},this.update_zoom=function(t){var e=Y(this);if(this.canvasROI){var a=this.canvasROI.x,n=this.canvasROI.y,i=a+this.canvasROI.width,s=n+this.canvasROI.height;e.x=Math.max(Math.min(e.x,i),a),e.y=Math.max(Math.min(e.y,s),n)}for(var o in this.image_center.x=(this.image_center.x-e.x)*t+e.x,this.image_center.y=(this.image_center.y-e.y)*t+e.y,this.imageBound=H(this),this.imageROI=G(this),this.canvasROI=Z(this),this.bkgKImg.destroy(),this.bkgKImg=new Konva.Image({image:this.bkgImg,crop:this.imageROI,x:this.canvasROI.x,y:this.canvasROI.y,width:this.canvasROI.width,height:this.canvasROI.height}),this.bkgLayer.add(this.bkgKImg),this.bkgLayer.batchDraw(),this.ringObj&&(this.ringObj.x=(this.ringObj.x-e.x)*t+e.x,this.ringObj.y=(this.ringObj.y-e.y)*t+e.y,this.ringObj.r1=this.ringObj.r1*t,this.ringObj.r2=this.ringObj.r2*t),this.konvaObjs){var r=this.konvaObjs[o];if("Rect"==r.name()){a=r.x(),n=r.y(),i=a+(m=r.width()),s=n+(f=r.height());var c=(a-e.x)*t+e.x,l=(n-e.y)*t+e.y,h=m*t,u=f*t;r.x(c),r.y(l),r.width(h),r.height(u)}else if("Ring"==r.name()){a=(v=r.getAbsolutePosition()).x,n=v.y;var d=r.innerRadius(),g=r.outerRadius(),y=(c=(a-e.x)*t+e.x,l=(n-e.y)*t+e.y,d*t),b=g*t;r.x(c),r.y(l),r.innerRadius(y),r.outerRadius(b)}else if("RBox"==r.name()||"FBox"==r.name()||"Quad"==r.name()||"Poly"==r.name()||"Curve"==r.name()||"RingBox"==r.name()){var v,p=X(r.attrs.points),m=(a=(v=r.getAbsolutePosition()).x,n=v.y,r.width()),f=r.height();c=(a-e.x)*t+e.x,l=(n-e.y)*t+e.y,h=m*t,u=f*t;for(var o in r.x(c),r.y(l),r.width(h),r.height(u),p){c=(a=p[o].x)*t,l=(n=p[o].y)*t;r.attrs.points[2*o]=c,r.attrs.points[2*o+1]=l}}if(!this.isPaint&&null!=this.curKonvaObj&&this.lockKonvaObj&&("RBox"==this.curKonvaObj.name()||"FBox"==this.curKonvaObj.name()||"Poly"==this.curKonvaObj.name()||"Curve"==this.curKonvaObj.name()||"Quad"==this.curKonvaObj.name()||"RingBox"==this.curKonvaObj.name())){var x=this.curKonvaObj;ht(this),bt(this,x)}}W(this.context),A(this),this.layer.batchDraw()},this.increaseAnchorSize=function(){if(this.anchor_size*=1.1,W(this.context),null!=this.curKonvaObj&&this.lockKonvaObj){var t=this.curKonvaObj;ht(this),bt(this,t)}A(this),this.layer.batchDraw()},this.decreaseAnchorSize=function(){if(this.anchor_size/=1.1,W(this.context),A(this),this.layer.batchDraw(),null!=this.curKonvaObj&&this.lockKonvaObj){var t=this.curKonvaObj;ht(this),bt(this,t)}},this.setMode=function(t){if("Move"==t)this.curObj.type=null,this.moveMode=!0;else{if("Copy"==t)return void(this.konvaObjs.length>=1&&(this.curObj.type=null,this.copyObj=this.konvaObjs[this.konvaObjs.length-1].clone(),this.layer.add(this.copyObj),this.copyMode=!0));if("RingBox"==t)if(this.konvaObjs.length>=1&&"Ring"==this.konvaObjs[this.konvaObjs.length-1].name()){var e=this.konvaObjs[this.konvaObjs.length-1];this.ringObj={x:e.x(),y:e.y(),r1:e.innerRadius(),r2:e.outerRadius()},this.konvaObjs.splice(this.konvaObjs.length-1,1),e.destroy(),this.curObj.type=t,this.moveMode=!1}else{if(!this.ringObj)return;this.curObj.type=t,this.moveMode=!1}else if("FCircle"==t)if(this.konvaObjs.length>=1&&"Circle"==this.konvaObjs[this.konvaObjs.length-1].name()){var a=this.konvaObjs[this.konvaObjs.length-1];this.circleObj={x:a.x(),y:a.y(),radius:a.radius()},this.curObj.type=t,this.curObj.circleObj=this.circleObj,this.moveMode=!1}else{if(!this.circleObj)return;this.curObj.type=t,this.moveMode=!1}else this.curObj.type=t,this.moveMode=!1,this.copyMode=!1,null!==this.copyObj&&this.copyObj.destroy()}this.stage.find(".RectToolItem").stroke("blue"),this.stage.find(".RBoxToolItem").stroke("blue"),this.stage.find(".FBoxToolItem").stroke("blue"),this.stage.find(".QuadToolItem").stroke("blue"),this.stage.find(".RingBoxToolItem").stroke("blue"),this.stage.find(".RingToolItem").stroke("blue"),this.stage.find(".CircleToolItem").stroke("blue"),this.stage.find(".FCircleToolItem").stroke("blue"),this.stage.find(".PolyToolItem").stroke("blue"),this.stage.find(".CurveToolItem").stroke("blue"),this.stage.find(".MoveToolItem").stroke("blue"),this.stage.find("."+t+"ToolItem").stroke("red"),W(this.context),A(this),this.layer.draw()},this.addToolBar=function(){var t=this,e=new Konva.Rect({x:0,y:0,width:20,height:12,name:"RectToolItem",stroke:"#2292cf",strokeWidth:0}),a=new Konva.Rect({x:0,y:0,width:20,height:12,name:"RBoxToolItem",stroke:"#2292cf",strokeWidth:0});xt(a,30);var n=new Konva.Rect({x:0,y:0,width:20,height:12,name:"FBoxToolItem",stroke:"#2292cf",strokeWidth:0});xt(n,30);var i=new Konva.Line({x:0,y:0,name:"QuadToolItem",points:[84,4,100,2,104,18,80,16],stroke:"#2292cf",strokeWidth:0,closed:!0}),s=new Konva.Line({x:0,y:0,name:"RingBoxToolItem",points:[84,4,100,2,104,18,80,16],stroke:"#2292cf",strokeWidth:0,closed:!0}),o=new Konva.Circle({x:10,y:10,name:"FCircleToolItem",radius:9,stroke:"#2292cf",strokeWidth:0}),r=new Konva.Circle({x:10,y:10,name:"CircleToolItem",radius:9,stroke:"#2292cf",strokeWidth:0}),c=new Konva.Ring({x:10,y:10,name:"RingToolItem",innerRadius:7,outerRadius:10,stroke:"#2292cf",strokeWidth:0}),l=new Konva.Line({x:0,y:0,name:"CurveToolItem",points:[135,4,138,5,141,3,148,1,155,3,153,12,148,15,151,19,139,14],stroke:"#2292cf",strokeWidth:0,closed:!0}),h=new Konva.Line({x:0,y:0,name:"PolyToolItem",points:[110,6,116,2,130,4,126,18,114,16],stroke:"#2292cf",strokeWidth:0,closed:!0}),u=new Konva.Text({x:0,y:0,text:"clear",fontSize:0,fontFamily:"Calibri",fill:"blue"}),d=new Konva.Line({x:0,y:0,name:"MoveToolItem",points:[170,0,170,19,170,10,160,10,180,10,170,10,170,0],stroke:"red",strokeWidth:0,closed:!0});e.on("click",function(e){t.setMode("Rect")}),a.on("click",function(e){t.setMode("RBox")}),n.on("click",function(e){t.setMode("FBox")}),i.on("click",function(e){t.setMode("Quad")}),s.on("click",function(e){t.setMode("RingBox")}),r.on("click",function(e){t.setMode("Circle")}),o.on("click",function(e){t.setMode("FCircle")}),c.on("click",function(e){t.setMode("Ring")}),h.on("click",function(e){t.setMode("Poly")}),l.on("click",function(e){t.setMode("Curve")}),d.on("click",function(e){t.setMode("Move")}),this.clearToolItem=function(){t.stage.find(".Rect").destroy(),t.stage.find(".RBox").destroy(),t.stage.find(".FBox").destroy(),t.stage.find(".Quad").destroy(),t.stage.find(".RingBox").destroy(),t.stage.find(".Ring").destroy(),t.stage.find(".Circle").destroy(),t.stage.find(".FCircle").destroy(),t.stage.find(".Poly").destroy(),t.stage.find(".Curve").destroy(),t.stage.find(".Transformer").destroy(),t.konvaObjs=[],t.layer.draw()},u.on("click",function(e){t.stage.find(".Rect").destroy(),t.stage.find(".RBox").destroy(),t.stage.find(".FBox").destroy(),t.stage.find(".Quad").destroy(),t.stage.find(".RingBox").destroy(),t.stage.find(".Ring").destroy(),t.stage.find(".Circle").destroy(),t.stage.find(".FCircle").destroy(),t.stage.find(".Poly").destroy(),t.stage.find(".Curve").destroy(),t.stage.find(".Transformer").destroy(),t.konvaObjs=[],t.layer.draw()}),this.layer.add(e),this.layer.add(a),this.layer.add(n),this.layer.add(i),this.layer.add(h),this.layer.add(l),this.layer.add(d),this.layer.add(u),this.layer.draw()},this.changeOpacity=function(t){R=t}}var ft=function(t,e){var a=t.x,n=t.y,i=Math.cos(e),s=Math.sin(e);return{x:a*i-n*s,y:n*i+a*s}};function xt(t,e){var a={x:-t.width()/2,y:-t.height()/2},n=ft(a,Konva.getAngle(t.rotation())),i=ft(a,Konva.getAngle(e)),s=i.x-n.x,o=i.y-n.y;t.rotation(e),t.x(t.x()+s),t.y(t.y()+o)}a(201);var Ot=a(658),jt=a(616),kt=a(593),wt=a.n(kt),Pt=a(105),_t=a(627),Ct=function(t){function e(){var t,a,i;Object(n.a)(this,e);for(var r=arguments.length,c=new Array(r),h=0;h<r;h++)c[h]=arguments[h];return Object(s.a)(i,(a=i=Object(s.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(c))),i.state={size:localStorage.getItem("size")||"Rect",content1:"",content2:"",content3:"",konvaObjsNum:0,dataShiftArr:[]},i.componentWillUnmount=function(){window.removeEventListener("mouseup",function(){})},i.focusIndex=function(t){return i.indexFocus=t,t},i.delStateContent=function(t){var e,a;a=i.state.konvaObjsNum>0?i.state.konvaObjsNum-1:0,i.setState((e={},Object(g.a)(e,"content".concat(a+1),""),Object(g.a)(e,"konvaObjsNum",a),e))},i.rightMenu=function(){var t=document.getElementById("menu");document.oncontextmenu=function(e){var a=e;return t.style.display="block",t.style.left=a.clientX+"px",t.style.top=a.clientY+"px",!1},document.onclick=function(){t.style.display="none"}},i.getSearchString=function(t){for(var e=window.location.search,a=(e=e.substring(1,e.length)).split("&"),n=new Object,i=0;i<a.length;i++){var s=a[i].split("=");n[s[0]]=s[1]}return n[t]},i.getTaskId=function(){i.getSearchString();var t=window.location.search,e=t.slice(1);if(e.includes("&")){if(e.includes("label")){var a=i.getSearchString("label");a&&(i.allowLabelTypes=a.split(","))}if(e.includes("tag")){if(e=t.slice(1,e.indexOf("&")+1),t.includes("=")){var n=i.getSearchString("tag");n&&(i.tags=n.split(","))}}else e=t.slice(1,e.indexOf("&")+1),"1"===i.getSearchString("labeled")?(i.isLabeled=!0,i.label_id=i.getSearchString("label_id"),i.today=i.getSearchString("today"),i.page=i.getSearchString("page"),i.page=i.getSearchString("page"),"1"===i.getSearchString("failed")&&(i.isFailed=!0)):"1"===i.getSearchString("check")&&(i.isCheck=!0,i.label_id=i.getSearchString("label_id"),i.page=i.getSearchString("page"))}return e},i.getData=function(t){var e={task_id:i.getTaskId(),count:3};t&&(e.page=t),Ot.a.getLabel(wt.a.stringify(e)).then(function(t){if(200===t.code){if(console.log(t),0==t.data.length)return void b.a.error("\u6ca1\u6570\u636e");i.fname=t.data[0].fname,i.setState({data:t.data,label_id:t.data[0].label_id},function(){var t="",e=new Image;t="http"===i.state.data[0].image_url.slice(0,4)?i.state.data[0].image_url:Pt.a.imgURL+i.state.data[0].image_url,e.src=t,e.onload=function(){var a;i.width=e.width,i.height=e.height,a=e.width/e.height,i.init(t,a.toFixed(2))},e.onerror=function(t){b.a.error("\u56fe\u7247\u52a0\u8f7d\u9519\u8bef")}})}else 501===t.code?b.a.error("\u6ca1\u6709\u6570\u636e\u4e86\ud83d\ude20"):b.a.error("\u8bf7\u6c42\u5931\u8d25")})},i.init=function(t,e,a){var n=window.document.body.clientWidth-510;i.img=t,i.rate=e,i.results=a;var s={width:n,height:e?n/e:500,margin:10,container:"container",imgpath:t,results:a?a.replace(/FBox/g,"RBox"):"[]"},o=new mt(s);i.labelView=o,o.bindEvents(),o.addToolBar(),o.loadResults(s.results),i.allowLabelTypes&&i.allowLabelTypes.includes("Rect")?(localStorage.setItem("size","Rect"),i.setState({size:"Rect"})):i.allowLabelTypes&&i.allowLabelTypes.length>0&&(localStorage.setItem("size",i.allowLabelTypes[0]),i.setState({size:i.allowLabelTypes[0]})),o.setMode(localStorage.getItem("size")||i.state.size),window.addEventListener("mouseup",function(){i.state.konvaObjsNum!==i.labelView.konvaObjs.length&&i.setState({konvaObjsNum:i.labelView.konvaObjs.length})}),window.document.onkeyup=function(t){16==t.keyCode&&(i.labelView.setMode(localStorage.getItem("size")),document.querySelector("#container").style.cursor="auto")},window.document.onkeydown=function(t){8===t.keyCode||46===t.keyCode?o.deleteObj():27===t.keyCode?o.cancel():49==t.keyCode&&t.altKey?(o.setMode("Rect"),localStorage.setItem("size","Rect"),i.setState({size:"Rect"})):50==t.keyCode&&t.altKey?(o.setMode("RBox"),localStorage.setItem("size","RBox"),i.setState({size:"RBox"})):51==t.keyCode&&t.altKey?(o.setMode("FBox"),localStorage.setItem("size","FBox"),i.setState({size:"FBox"})):52==t.keyCode&&t.altKey?(o.setMode("Quad"),localStorage.setItem("size","Quad"),i.setState({size:"Quad"})):53==t.keyCode&&t.altKey?(o.setMode("Poly"),localStorage.setItem("size","Poly"),i.setState({size:"Poly"})):54==t.keyCode&&t.altKey?(o.setMode("Curve"),localStorage.setItem("size","Curve"),i.setState({size:"Curve"})):55==t.keyCode&&t.altKey?(o.setMode("Ring"),localStorage.setItem("size","Ring"),i.setState({size:"Ring"})):56==t.keyCode&&t.altKey?(o.setMode("RingBox"),localStorage.setItem("size","RingBox"),i.setState({size:"RingBox"})):57==t.keyCode&&t.altKey?(o.setMode("Circle"),localStorage.setItem("size","Circle"),i.setState({size:"Circle"})):48==t.keyCode&&t.altKey?(o.setMode("FCircle"),localStorage.setItem("size","FCircle"),i.setState({size:"FCircle"})):68==t.keyCode&&t.altKey?o.displayResult():219==t.keyCode?o.zoom_out():221==t.keyCode?o.zoom_in():37==t.keyCode?i.prevPage():39==t.keyCode?i.nextPage():38==t.keyCode?i.save():40==t.keyCode?i.save("abandoned"):83==t.keyCode&&t.altKey?i.save():82==t.keyCode&&t.altKey?i.repaint():81==t.keyCode&&t.altKey?i.clear():81==t.keyCode&&t.altKey?i.save("abandoned"):67==t.keyCode&&t.altKey?(i.labelView.setMode("Copy"),i.setState({size:"Copy"})):16==t.keyCode?(i.labelView.setMode("Move"),document.querySelector("#container").style.cursor="move"):9==t.keyCode&&(i.changeOpacity?(i.changeOpacity=null,o.changeOpacity(1),i.init(i.img,i.rate,JSON.stringify(o.displayResult()))):(i.changeOpacity=!0,o.changeOpacity(0),i.init(i.img,i.rate,JSON.stringify(o.displayResult()))),t.preventDefault())}},i.prevPage=function(t){var e=i.state,a=e.dataShiftArr,n=e.data;if(a.length>0){var s=a.pop();n.unshift(s),i.fname=s.fname,i.getLabel(s,n,a)}else{if(i.isCheck||i.isLabeled||i.isFailed)return i.curPage>i.state.maxPage&&(i.curPage=i.state.maxPage),void(1===i.curPage?b.a.error("\u8fd9\u5c31\u662f\u7b2c\u4e00\u5f20\ud83d\ude0a"):(i.reversal=!0,i.curPage=i.curPage-1,i.isLabeled||i.isFailed?i.getLabeledLists():i.isCheck&&i.getCheckLists()));b.a.error("\u8fd9\u5c31\u662f\u7b2c\u4e00\u5f20\ud83d\ude01")}},i.nextPage=function(t){i.isLabeled||i.isCheck||(i.startLabelTime=(new Date).getTime());var e=i.state,a=e.data,n=e.dataShiftArr;if(a&&a.length>1){var s=a.shift();n.push(s);var o={task_id:i.getTaskId(),label_id:a[0].label_id};Ot.a.getLabel(wt.a.stringify(o)).then(function(t){if(200===t.code)if(i.fname=t.data[0].fname,11!==t.data[0].labels.check_status?i.setState({status:t.data[0].labels.check_status,isCheck:!0}):i.setState({isCheck:!1}),t.data&&t.data[0].labels&&10===t.data[0].labels.label_status)i.getLabel(a[0],a,n),i.setState({abandoned:!1});else if(t.data&&t.data[0].labels&&9===t.data[0].labels.label_status)i.getLabel(a[0],a,n),i.setState({abandoned:!0});else{i.setState({abandoned:!1});var e=new Image;e.src="http"===a[0].image_url.slice(0,4)?a[0].image_url:Pt.a.imgURL+a[0].image_url,e.onload=function(){var t;i.width=e.width,i.height=e.height,t=e.width/e.height,i.init(e.src,t.toFixed(2))},i.setState({data:a,label_id:a[0].label_id,dataShiftArr:n}),i.clear()}})}else i.isLabeled||i.isFailed?i.getLabeledLists():i.isCheck?i.getCheckLists():i.getData()},i.getLabel=function(t,e,a){var n={task_id:i.getTaskId(),label_id:t.label_id};i.fname=t.fname,Ot.a.getLabel(wt.a.stringify(n)).then(function(n){if(200===n.code){11!==n.data[0].labels.check_status?i.setState({status:n.data[0].labels.check_status,isCheck:!0}):i.setState({isCheck:!1}),9===n.data[0].labels.label_status?i.setState({abandoned:!0}):i.setState({abandoned:!1});var s="[]",o=0,r="";r="http"===t.image_url.slice(0,4)?t.image_url:Pt.a.imgURL+t.image_url;var c=n.data[0].labels.label_data;c&&(o=c.length,c.map(function(t,e){delete t.paths_pixel,i.state["content".concat(e+1)]=t.content,delete t.content}),s=JSON.stringify(c));var l=new Image;l.src=r,l.onload=function(){var t;i.width=l.width,i.height=l.height,t=l.width/l.height,i.init(r,t.toFixed(2),s)},i.setState({data:e,dataShiftArr:a,label_id:t.label_id,konvaObjsNum:o})}else b.a.error("\u8bf7\u6c42\u5931\u8d25")})},i.getTime=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" 00:00:00"},i.getCheckLists=function(){var t={task_id:i.getSearchString("task_id"),user_id:i.getSearchString("user_id"),per_page:20};i.curPage?t.page=i.curPage:t.page=Number(i.page)||1,i.reversal||(i.curPage=t.page+1),t.page>i.state.maxPage?b.a.error("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u8d28\u68c0\u7684\u6570\u636e\u4e86"):jt.a.getCheckBrowser(wt.a.stringify(t)).then(function(t){if(200===t.code){var e,a=t.data;if(a.some(function(t,a){if(i.label_id==t.label_id)return e=a,!0}),i.reversal){i.reversal=!1;var n=a.pop();return i.setState({label_id:n.label_id,dataShiftArr:a,data:[n].concat(Object(d.a)(i.state.data)),maxPage:Math.ceil(t.total/20)}),void i.getLabeled(n.label_id)}if(e){var s=a.filter(function(t,a){return a<e}),o=a.filter(function(t,a){return a>=e});i.setState({dataShiftArr:s,data:o,maxPage:Math.ceil(t.total/20)})}else i.setState({label_id:a[0].label_id,data:a,maxPage:Math.ceil(t.total/20)}),i.getLabeled(a[0].label_id)}else console.error("\u6ca1\u6709\u6570\u636e")})},i.getLabeledLists=function(){var t={task_id:i.getTaskId()};i.today&&"null"!==i.today&&(t.start_dt=i.getTime()),i.isFailed&&(t.check_deny=!0),i.curPage?t.page=i.curPage:t.page=Number(i.page)||1,i.reversal||(i.curPage=t.page+1),t.page>i.state.maxPage?i.today&&"null"!==i.today?b.a.error("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u67e5\u770b\u7684\u4eca\u65e5\u5df2\u6807\u6570\u636e\u4e86"):b.a.error("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u67e5\u770b\u7684\u5df2\u6807\u6570\u636e\u4e86"):Ot.a.getLabelBrowser(wt.a.stringify(t)).then(function(t){if(200===t.code){var e,a=t.data;if(a.some(function(t,a){if(i.label_id==t.label_id)return e=a,!0}),i.reversal){i.reversal=!1;var n=a.pop();return i.setState({label_id:n.label_id,dataShiftArr:a,data:[n].concat(Object(d.a)(i.state.data)),maxPage:Math.ceil(t.total/20)}),void i.getLabeled(n.label_id)}if(e){var s=a.filter(function(t,a){return a<e}),o=a.filter(function(t,a){return a>=e});i.setState({dataShiftArr:s,data:o,maxPage:Math.ceil(t.total/20)})}else i.setState({label_id:a[0].label_id,data:a,maxPage:Math.ceil(t.total/20)}),i.getLabeled(a[0].label_id)}else console.error("\u6ca1\u6709\u6570\u636e")})},i.getLabeled=function(t){var e={task_id:i.getTaskId(),label_id:t||i.label_id};Ot.a.getLabel(wt.a.stringify(e)).then(function(t){if(console.log(111,t),200===t.code){var e=t.data[0];11!==t.data[0].labels.check_status?i.setState({status:e.labels.check_status,isCheck:!0}):i.setState({isCheck:!1}),9===t.data[0].labels.label_status?i.setState({abandoned:!0}):i.setState({abandoned:!1});var a="[]",n=0,s="";s="http"===e.image_url.slice(0,4)?e.image_url:Pt.a.imgURL+e.image_url;var o=e.labels.label_data;o&&(n=o.length,o.map(function(t,e){delete t.paths_pixel,i.state["content".concat(e+1)]=t.content,delete t.content}),a=JSON.stringify(o));var r=new Image;r.src=s,r.onload=function(){var t;i.width=r.width,i.height=r.height,t=r.width/r.height,i.init(s,t.toFixed(2),a)},i.setState({label_id:e.label_id,konvaObjsNum:n})}else b.a.error("\u8bf7\u6c42\u5931\u8d25")})},i.check=function(t){for(var e=i.labelView.displayResult(),a=function(t){var a=[];"FBox"===e[t].type&&(e[t].type="RBox"),e[t].paths.forEach(function(t){a.push({x:i.width*t.x,y:i.height*t.y})}),i.state["content".concat(t+1)]?Object.assign(e[t],{content:i.state["content".concat(t+1)]},{paths_pixel:a}):Object.assign(e[t],{content:""})},n=0;n<e.length;n++)a(n);var s,o={label_id:i.state.label_id,label_data:e};"accept"==t?s="postCheckAccept":"deny"==t?s="postCheckDeny":"abandon"==t&&(s="postCheckAbandon"),jt.a[s](o).then(function(t){200===t.code?i.nextPage():b.a.error(t.message)})},i.save=function(t){var e=i.labelView.displayResult();console.log(e);for(var a=function(t){var a=[];"FBox"===e[t].type&&(e[t].type="RBox"),e[t].paths.forEach(function(t){a.push({x:i.width*t.x,y:i.height*t.y})}),i.state["content".concat(t+1)]?Object.assign(e[t],{content:i.state["content".concat(t+1)]},{paths_pixel:a}):Object.assign(e[t],{content:""},{paths_pixel:a})},n=0;n<e.length;n++)a(n);var s={label_id:i.state.label_id,label_data:e};console.log(t),"abandoned"===t&&(s.abandoned=!0),i.isCheck||i.isLabeled||(s.cost=((new Date).getTime()-i.startLabelTime)/1e3),i.clear(),Ot.a.postLabel(s).then(function(t){200===t.code?i.nextPage():b.a.error(t.message)})},i.clear=function(){i.labelView.clearToolItem(),i.setState({konvaObjsNum:0,content1:"",content2:"",content3:"",content4:"",content5:"",content6:"",content7:"",content8:"",content9:"",content10:"",content11:"",content12:"",content13:"",content14:"",content15:"",content16:"",content17:""})},i.deleteObj=function(t){i.labelView.deleteObj(t)},i.getInputs=function(t){if(t){for(var e=[],a=0;a<t;a++)e.push(i.getInput(a));return i.children=e,e}},i.getInput=function(t){return l.a.createElement("div",{key:t},l.a.createElement("span",null,"\u6807\u6ce8",t+1,":")," ",l.a.createElement("a",{className:u.a.del,onClick:function(){i.deleteObj(t)}},"\u5220\u9664"),l.a.createElement(v.a,{onChange:i.changeContent.bind(Object(y.a)(Object(y.a)(i)),"content".concat(t+1)),value:i.state["content".concat(t+1)],placeholder:"\u8bf7\u8f93\u5165\u6807\u6ce8\u5185\u5bb9"}))},i.handleZoomChange=function(t){"zoom_in"===t?i.labelView.zoom_in():i.labelView.zoom_out()},i.handleSizeChange=function(t){i.setState({size:t.target.value}),localStorage.setItem("size",t.target.value),i.labelView.setMode(t.target.value)},i.changeContent=function(t,e){i.setState(Object(g.a)({},t,e.target.value))},i.repaint=function(){i.labelView.repaint()},i.zoomIn=function(){i.labelView.zoom_in()},i.zoomOut=function(){i.labelView.zoom_out()},i.copy=function(){i.labelView.setMode("Copy")},i.setStateContent=function(t){null!==i.indexFocus&&i.setState(Object(g.a)({},"content".concat(i.indexFocus+1),t)),i.tags.length>1&&i.setState(Object(g.a)({},"content".concat(i.state.konvaObjsNum+1),t))},i.onChange=function(t){i.changeOpacity?(i.changeOpacity=null,i.labelView.changeOpacity(1),i.init(i.img,i.rate,JSON.stringify(i.labelView.displayResult()))):(i.changeOpacity=!0,i.labelView.changeOpacity(0),i.init(i.img,i.rate,JSON.stringify(i.labelView.displayResult()))),console.log("switch to ".concat(t))},i.getAllowLabelTypesButton=function(){return i.allowLabelTypes.includes("RBox")&&!i.allowLabelTypes.includes("FBox")&&i.allowLabelTypes.push("FBox"),i.allowLabelTypes.includes("Copy")||i.allowLabelTypes.push("Copy"),i.allowLabelTypes.includes("Move")||i.allowLabelTypes.push("Move"),i.allowLabelTypes.map(function(t){return l.a.createElement(p.a.Button,{key:t,value:t},_t.a[t])})},a))}return Object(r.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){if(this.getTaskId(),w.on("stateContent",this.delStateContent),w.on("focusIndex",this.focusIndex),this.tags){if(1===this.tags.length)for(var t=0;t<10;t++)this.setState(Object(g.a)({},"content".concat(t+1),this.tags[0]));this.rightMenu()}this.label_id&&this.isLabeled?(this.getLabeled(),this.getLabeledLists()):this.label_id&&this.isCheck?(this.getLabeled(),this.getCheckLists()):(this.startLabelTime=(new Date).getTime(),this.getData())}},{key:"render",value:function(){var t=this;return l.a.createElement("div",{className:u.a.example},l.a.createElement("div",{id:"menu",className:u.a.menu},l.a.createElement("ul",null,this.tags?this.tags.map(function(e,a){return l.a.createElement("li",{key:a,onClick:function(){t.setStateContent(e)}},e)}):"")),l.a.createElement("div",null,l.a.createElement(m.a,{title:"\u5de6\u7bad\u5934",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.page,onClick:this.prevPage},"\u4e0a\u4e00\u9875")),l.a.createElement(m.a,{title:"\u53f3\u7bad\u5934",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.page,onClick:this.nextPage},"\u4e0b\u4e00\u9875")),l.a.createElement(m.a,{title:"\n              \u5de6\u7bad\u5934->\u4e0a\u4e00\u9875 /\n              \u53f3\u7bad\u5934->\u4e0b\u4e00\u9875 /\n              alt+s->\u4fdd\u5b58 /\n              alt+q->\u5e9f\u5f03 /\n              alt+r->\u91cd\u7ed8 /\n              alt+c->\u6e05\u9664 /\n              alt+1->\u77e9\u5f62 /\n              alt+2->\u65cb\u8f6c\u77e9\u5f62 /\n              alt+3->\u4e0a\u6b21\u65cb\u8f6c\u77e9\u5f62 /\n              alt+4->\u56db\u8fb9\u5f62 /\n              alt+5->\u591a\u8fb9\u5f62 /\n              alt+6->\u66f2\u7ebf /\n              alt+7->\u5706\u73af /\n              alt+8->\u6247\u5f62 /\n              \u4e00\u76f4shift->\u62d6\u52a8\n              "},l.a.createElement(x.a,{type:"info-circle"})),l.a.createElement(O.a,{className:u.a.switch,onChange:this.onChange}),this.state.isCheck?l.a.createElement(j.a,{color:_t.c[this.state.status]},_t.b[this.state.status]):""),l.a.createElement(p.a.Group,{className:u.a.marginRightBottom,value:this.state.size,onChange:this.handleSizeChange},this.allowLabelTypes?this.getAllowLabelTypesButton():l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a,{title:"alt+1",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Rect"},"\u77e9\u5f62")),l.a.createElement(m.a,{title:"alt+2",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"RBox"},"\u65cb\u8f6c\u77e9\u5f62")),l.a.createElement(m.a,{title:"alt+3",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"FBox"},"\u4e0a\u6b21\u65cb\u8f6c\u77e9\u5f62")),l.a.createElement(m.a,{title:"alt+4",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Quad"},"\u56db\u8fb9\u5f62")),l.a.createElement(m.a,{title:"alt+5",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Poly"},"\u591a\u8fb9\u5f62")),l.a.createElement(m.a,{title:"alt+6",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Curve"},"\u66f2\u7ebf")),l.a.createElement(m.a,{title:"alt+7",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Ring"},"\u5706\u73af")),l.a.createElement(m.a,{title:"alt+8",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"RingBox"},"\u6247\u5f62")),l.a.createElement(m.a,{title:"shift",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Move"},"\u62d6\u52a8")),l.a.createElement(m.a,{title:"alt+c",mouseEnterDelay:2},l.a.createElement(p.a.Button,{value:"Copy"},"\u590d\u5236")))),l.a.createElement(m.a,{title:"alt+q",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.marginRight,icon:"delete",onClick:this.clear},"\u6e05\u9664")),l.a.createElement(m.a,{title:"[",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.marginRight,icon:"zoom-in",onClick:this.zoomIn},"\u653e\u5927")),l.a.createElement(m.a,{title:"]",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.marginRight,icon:"zoom-out",onClick:this.zoomOut},"\u7f29\u5c0f")),l.a.createElement(m.a,{title:"alt+r",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.marginRight,icon:"redo",onClick:this.repaint},"\u91cd\u7ed8")),this.state.abandoned?l.a.createElement("div",{className:u.a.abandoned},"\u5df2\u5e9f\u5f03"):"",l.a.createElement("div",{className:u.a.fname},this.fname?this.fname.lastIndexOf("_")>-1?l.a.createElement("span",null,this.fname.slice(0,this.fname.lastIndexOf("_")+1),l.a.createElement("span",{className:u.a.underline},this.fname.slice(this.fname.lastIndexOf("_")+1,-4)),this.fname.slice(-4)):this.fname:""),l.a.createElement("div",{id:"container"}),l.a.createElement("div",{className:u.a.right},this.getInputs(this.state.konvaObjsNum)),this.isCheck?l.a.createElement(l.a.Fragment,null,l.a.createElement(f.a,{className:u.a.save,type:"primary",onClick:function(){t.check("accept")}},"\u5408\u683c"),l.a.createElement(f.a,{className:u.a.save,type:"primary",onClick:function(){t.check("deny")}},"\u4e0d\u5408\u683c"),l.a.createElement(m.a,{title:"alt+q",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.save,type:"danger",onClick:function(){t.check("abandon")}},"\u5f03\u7528"))):l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a,{title:"alt+s",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.save,type:"primary",onClick:this.save},"\u4fdd\u5b58")),l.a.createElement(m.a,{title:"alt+q",mouseEnterDelay:2},l.a.createElement(f.a,{className:u.a.save,type:"danger",onClick:this.save.bind(this,"abandoned")},"\u5f03\u7528"))))}}]),e}(c.Component),Rt=function(t){function e(){return Object(n.a)(this,e),Object(s.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return l.a.createElement("div",{className:u.a.example},l.a.createElement(Ct,null))}}]),e}(c.Component);e.default=Rt},616:function(t,e,a){"use strict";var n=a(22),i=a(105).a.version;i+="check/",e.a={getCheckBrowser:function(t){return n.b("".concat(i,"browser"),t)},getCheckDetail:function(t){return n.b("".concat(i,"detail"),t)},postCheckAccept:function(t){return n.c("".concat(i,"accept"),t)},postCheckDeny:function(t){return n.c("".concat(i,"deny"),t)},postCheckAbandon:function(t){return n.c("".concat(i,"abandon"),t)}}},627:function(t,e,a){"use strict";a.d(e,"b",function(){return n}),a.d(e,"c",function(){return i}),a.d(e,"a",function(){return s});var n={0:"\u9ed8\u8ba4",9:"\u6807\u6ce8\u5f03\u7528",10:"\u6807\u6ce8\u5b8c\u6210",18:"\u8d28\u68c0\u4e0d\u5408\u683c",19:"\u8d28\u68c0\u5f03\u7528",20:"\u8d28\u68c0\u5408\u683c"},i={0:"geekblue",9:"gray",10:"green",18:"red",19:"gray",20:"green"},s={Rect:"\u77e9\u5f62",RBox:"\u65cb\u8f6c\u77e9\u5f62",FBox:"\u4e0a\u6b21\u65cb\u8f6c\u77e9\u5f62",Quad:"\u56db\u8fb9\u5f62",Poly:"\u591a\u8fb9\u5f62",Curve:"\u66f2\u7ebf",Copy:"\u590d\u5236",Move:"\u62d6\u52a8"}},658:function(t,e,a){"use strict";var n=a(22),i=a(105).a.version;e.a={getLabel:function(t){return n.b("".concat(i,"label"),t)},postLabel:function(t){return n.c("".concat(i,"label"),t)},getMyLabel:function(t){return n.b("".concat(i,"label/my"),t)},getLabelBrowser:function(t){return n.b("".concat(i,"label/browser"),t)}}},686:function(t,e,a){t.exports={example:"dnHQS_vJpy9a4GSeK5twn",marginRight2:"_2TQaF5BD65Zin6AvJYOZsG",marginRight1:"_15s6hthYkSO4qmXAVQqosN",marginRight:"_14wq3fLbeyfw1TW5KDzXPY",marginBottom:"_37xR6-3paCc9PHzClRg1ed",marginRightBottom:"_2qu9PlcAsuMIS4AIzG5J_P",right:"_3Uom2313jG2WIBU9QKiYEI",save:"_4n9RUiqXe2Xz8lAuLS8mK",page:"_1sXdfvsP7DgswMc74ZYl6v",abandoned:"_3w5R824qkwavzejsgjG2-v",menu:"MtqxT-lr1ynD3ZFpWoEoz",del:"_1-Zsqh9kBxPRz1bpI2CFsL",switch:"_2UdBtGs9x9snM29S1gPjQC",fname:"_37M44M460Z_U7HadO4-HXV",underline:"_3YNjB6oRN_sKgelZhTONw9"}},877:function(t,e){},878:function(t,e){},879:function(t,e){},883:function(t,e){},885:function(t,e){},919:function(t,e){},920:function(t,e){},975:function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id=975}}]);